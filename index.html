
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>GSoC 2013 - RTEMS Virtualization Layer Project</title>
  <meta name="author" content="Philipp Eppelt">

  
  <meta name="description" content="This post is about code generation in POK and how the libpart target can be
included in the automatic generation process. First I will discuss where &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://phipse.github.io/rtems">
  <link href="/rtems/favicon.png" rel="icon">
  <link href="/rtems/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/rtems/atom.xml" rel="alternate" title="GSoC 2013 - RTEMS Virtualization Layer Project" type="application/atom+xml">
  <script src="/rtems/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/rtems/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/rtems/">GSoC 2013 - RTEMS Virtualization Layer Project</a></h1>
  
    <h2>Progress, Issues, Design</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/rtems/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:phipse.github.io/rtems" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/rtems/">Blog</a></li>
  <li><a href="/rtems/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/rtems/blog/2013/07/28/generation-of-libpart-target/">Generation of Libpart Target</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-28T19:22:00+02:00" pubdate data-updated="true">Jul 28<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This post is about code generation in POK and how the libpart target can be
included in the automatic generation process. First I will discuss where the
configuration for the generation is done; Second I talk about the reasons, why
I won&rsquo;t intercept this process and which solution I settled with.</p>

<h2>How Makefiles are generated</h2>

<p>Like the name &lsquo;generated-code&rsquo; would suggest, every file below this directory
is generated by ocarina. But I wondered: Where are the specifications for this
process?
After a vain search through the POK sources I looked at the ocarina sources.
Where else could the specs be? And here are a couple of files name
<strong>ocarina-backends-pok_c-* </strong>. One of them is named
<strong>ocarina-backends-pok_c-makefiles.adb</strong> and in the procedure
<strong>Visit_Processor_Instance</strong> the main Makefile is written. Right below the
kernel Makefile is created, too. Every line that shows up in the generated
Makefiles is specified here and depending on your architecture and BSP it is
written out.
But where are the partition Makefiles created?
In the procedure <strong>Visit_Process_Or_Device_Instance</strong>. And here we are the
point where I want to include libpart as an Makefile to be included and as a
target.</p>

<h2>Get libpart into the generation</h2>

<p>To get libpart into the Makefile generation I need to change ocarina source
code. I don&rsquo;t like this idea. I don&rsquo;t want to get into a third project. But do
I have to, even if I don&rsquo;t want to?</p>

<p>Why did I want my own makefile target in the first place?
Usually, POK is build for embedded devices and the virtualization capability is
not in the main focus of the system. Libpart is a custom to the virtualization
of RTEMS and is not necessary for everything else. So fusing the build of
libpart into the partition target, would build it even if it is not needed.
That is the case for nearly every system.</p>

<p>On the other hand libpok is only generated at compile time and doesn&rsquo;t
influence the binary. So it has no impact on the performance of the target
system and a tiny compile time addition isn&rsquo;t noticeable on todays systems.</p>

<p>After reconsidering the decision process I will try to build libpart together
with the partition, without modifying ocarina.
I just included the current libpart make rule in the prerequisites of the
target rule in <strong>rules-partition.mk</strong> but unfortunatly it isn&rsquo;t that easy, as
the <strong>$+</strong> opartor is trying to include libpart in the binary.
The second target mentioned in the partition&rsquo;s makefile is libpok. But as
libpart depends on libpok I can&rsquo;t use libpart as prerequisite for libpok.
The current solution is to build libpart under the libpok target and adding the
$(OBJS) as prerequisite.</p>

<p>I rebuild the <strong>rtems-guest</strong> example without errors and compared the nm output
of a former libpart.a with the new one. It was equal. To test if the change
broke something I ran <strong>make test</strong>. All test cases compiled successfully.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/rtems/blog/2013/07/09/how-late-is-it/">How Late Is It?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-09T00:00:00+02:00" pubdate data-updated="true">Jul 9<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The big question is: How can we pass the time to RTEMS?
POK doesn&rsquo;t provide a mechanism to pass time to a partition, however, the partition can
ask how late it is. But this doesn&rsquo;t help. Hence, we need to design a new
mechanism in POK and RTEMS to let the two work together.</p>

<p><em>Caution</em>: This is a very long post!</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/rtems/blog/2013/07/09/how-late-is-it/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/rtems/blog/2013/07/08/HelloWorld/">Hello World - Describing the Build Process</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-08T00:00:00+02:00" pubdate data-updated="true">Jul 8<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The good news first: Hello World runs!</p>

<p>To get there you need five steps:</p>

<ol>
<li>Build the rtems-guest example in POK.</li>
<li>Copy libpart.a part1/ to virtPok/</li>
<li>Build virtPok BSP</li>
<li>Copy hello binary to POK partition and rebuild kernel binary</li>
<li>make run</li>
</ol>


</div>
  
  
    <footer>
      <a rel="full-article" href="/rtems/blog/2013/07/08/HelloWorld/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/rtems/blog/2013/07/07/Modeling-the-partition/">Memory Partition and Pointers</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-07T00:00:00+02:00" pubdate data-updated="true">Jul 7<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I had the issue, that the file POK uses as buffer to tell the kernel what to
print on the screen, was outside of the partition. Well, outside as in the
filepointer was pointing to a memory location, which was outside the memory
slice configured in the AADL model (model.aadl).
So when modelling the partition, that should contain the guest, keep in mind to
define enough memory for the binary.</p>

<p>As you can see the kernel uses the model.aadl parameters to check the partition,
even if your ELF binary is using different memory sizes.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/rtems/blog/2013/07/07/GDB-hell/">GDB Hell - Maybe You Get Lucky</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-07T00:00:00+02:00" pubdate data-updated="true">Jul 7<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>How the heck can I debug this monster? I can show you how to survive at least a
couple of minutes.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/rtems/blog/2013/07/07/GDB-hell/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/rtems/blog/2013/07/05/RTEMS-World/">RTEMS I386 Split - How to Support a Virtualized CPU</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-05T00:00:00+02:00" pubdate data-updated="true">Jul 5<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>There are several x86 instructions that are not allowed in a virtualized
environment. Hence, I introduced a new CPU model called <em>virtual</em> in the i386
branch of RTEMS, which is equal to the <em>native</em> branch, except sensitive
instructions like hlt, cli, sli.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/rtems/blog/2013/07/05/RTEMS-World/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/rtems/blog/2013/07/05/POK-World/">POK Model and Changes to the Build System</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-05T00:00:00+02:00" pubdate data-updated="true">Jul 5<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I will discuss the POK code and model written to contain the final
RTEMS-POK-Partition-binary and changes and additions to the build system to
generate the necessary library.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/rtems/blog/2013/07/05/POK-World/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  <div class="pagination">
    
    <a href="/rtems/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/rtems/blog/2013/07/28/generation-of-libpart-target/">Generation of Libpart Target</a>
      </li>
    
      <li class="post">
        <a href="/rtems/blog/2013/07/09/how-late-is-it/">How Late Is It?</a>
      </li>
    
      <li class="post">
        <a href="/rtems/blog/2013/07/08/HelloWorld/">Hello World - Describing the Build Process</a>
      </li>
    
      <li class="post">
        <a href="/rtems/blog/2013/07/07/Modeling-the-partition/">Memory Partition and Pointers</a>
      </li>
    
      <li class="post">
        <a href="/rtems/blog/2013/07/07/GDB-hell/">GDB Hell - Maybe You Get Lucky</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/phipse">@phipse</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'phipse',
            count: 5,
            skip_forks: false,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/rtems/javascripts/github.js" type="text/javascript"> </script>
</section>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Philipp Eppelt -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











</body>
</html>
